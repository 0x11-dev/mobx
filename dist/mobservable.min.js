var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},mobservable;!function(a){function b(b,c){var e=null;Array.isArray&&Array.isArray(b)&&a.mobservableStatic.debugLevel&&d("mobservable.value() was invoked with an array. Probably you want to create an mobservable.array() instead of observing a reference to an array?"),e="function"==typeof b?new h(b,c):new g(b,c);var f=function(a){return arguments.length>0?e.set(a):e.get()};return f.observe=e.observe.bind(e),f.prop=e,f.toString=function(){return e.toString()},f}function c(a,b){if(!b.length)return[a,[]];if(!a.length)return[[],b];for(var c=[],d=[],e=0,f=0,g=a.length,h=!1,i=0,j=0,k=b.length,l=!1,m=!1;!m&&!h;){if(!l){if(g>e&&k>i&&a[e]===b[i]){if(e++,i++,e===g&&i===k)return[c,d];continue}f=e,j=i,l=!0}j+=1,f+=1,j>=k&&(m=!0),f>=g&&(h=!0),h||a[f]!==b[i]?m||b[j]!==a[e]||(d.push.apply(d,b.slice(i,j)),i=j+1,e++,l=!1):(c.push.apply(c,a.slice(e,f)),e=f+1,i++,l=!1)}return c.push.apply(c,a.slice(e)),d.push.apply(d,b.slice(i)),[c,d]}function d(a){console&&console.warn("[WARNING:mobservable] "+a)}function e(a){var b=!1;return function(){return b?void 0:(b=!0,a.apply(this,arguments))}}a.mobservableStatic=function(a,c){return b(a,c)},a.mobservableStatic.value=b,a.mobservableStatic.debugLevel=0,a.mobservableStatic.watch=function(a,b){var c,d=new i(!0);return d.nextState=function(){return c=a(),d.nextState=function(){return d.dispose(),b(),!1},!1},d.computeNextState(),[c,function(){return d.dispose()}]},a.mobservableStatic.observeProperty=function(b,c,f,i){if(void 0===i&&(i=!1),!b||!c||void 0===b[c])throw new Error("Object '"+b+"' has no key '"+c+"'.");if(!f||"function"!=typeof f)throw new Error("Third argument to mobservable.observeProperty should be a function");var k=b[c];if(k instanceof g||k instanceof j)return k.observe(f,i);if(k.prop&&k.prop instanceof g)return k.prop.observe(f,i);var l=new h(function(){return b[c]},b),m=l.observe(f,i);return a.mobservableStatic.debugLevel&&0===l.dependencyState.observing.length&&d("mobservable.observeProperty: property '"+c+"' of '"+b+" doesn't seem to be observable. Did you define it as observable?"),e(function(){m(),l.dependencyState.dispose()})},a.mobservableStatic.array=function(a){return new j(a)},a.mobservableStatic.toPlainValue=function(a){return a instanceof j?a.values():a},a.mobservableStatic.batch=function(a){return l.batch(a)},a.mobservableStatic.observable=function(b,c,d){var e=d?d.value:null;"function"==typeof e?(delete d.value,delete d.writable,d.get=function(){return a.mobservableStatic.props(this,c,e),this[c]},d.set=function(){throw console.trace(),new Error("It is not allowed to reassign observable functions")}):Object.defineProperty(b,c,{configurable:!0,enumberable:!0,get:function(){return a.mobservableStatic.props(this,c,void 0),this[c]},set:function(b){if(Array.isArray(b)){var d=new j(b);Object.defineProperty(this,c,{value:d,writeable:!1,configurable:!1,enumberable:!0})}else a.mobservableStatic.props(this,c,b)}})},a.mobservableStatic.props=function m(b,m,c){switch(arguments.length){case 0:throw new Error("Not enough arguments");case 1:return a.mobservableStatic.props(b,b);case 2:for(var d in m)a.mobservableStatic.props(b,d,m[d]);break;case 3:var e=a.mobservableStatic.value(c,b);Object.defineProperty(b,m,{get:function(){return e()},set:function(a){e(a)},enumerable:!0,configurable:!0})}return b},a.mobservableStatic.turnObservablesIntoProperties=function(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b]&&a[b].prop&&a[b].prop instanceof g){var c=a[b].prop;Object.defineProperty(a,b,{get:c.get.bind(c),set:c.set.bind(c),enumerable:!0,configurable:!0})}};var f,g=function(){function a(a,b){this._value=a,this.scope=b,this.changeEvent=new k,this.dependencyState=new i(!1)}return a.prototype.set=function(a){if(a!==this._value){var b=this._value;this.dependencyState.markStale(),this._value=a,this.dependencyState.markReady(!0),this.changeEvent.emit(a,b)}return this.scope},a.prototype.get=function(){return this.dependencyState.notifyObserved(),this._value},a.prototype.observe=function(a,b){var c=this;void 0===b&&(b=!1),this.dependencyState.setRefCount(1),b&&a(this.get(),void 0);var d=this.changeEvent.on(a);return e(function(){c.dependencyState.setRefCount(-1),d()})},a.prototype.toString=function(){return"Observable["+this._value+"]"},a}(),h=function(b){function c(a,c){if(b.call(this,void 0,c),this.func=a,this.isComputing=!1,this.hasError=!1,!a)throw new Error("ComputedObservable requires a function");this.dependencyState.isComputed=!0,this.dependencyState.nextState=this.compute.bind(this)}return __extends(c,b),c.prototype.get=function(){if(this.isComputing)throw new Error("Cycle detected");var b=this.dependencyState;if(b.isSleeping?i.trackingStack.length>0?(b.wakeUp(),b.notifyObserved()):this.compute():b.notifyObserved(),b.hasCycle)throw new Error("Cycle detected");if(this.hasError)throw a.mobservableStatic.debugLevel&&(console.trace(),d(this+": rethrowing caught exception to observer: "+this._value+(this._value.cause||""))),this._value;return this._value},c.prototype.set=function(a){throw new Error(this.toString()+": A computed observable does not accept new values!")},c.prototype.compute=function(){var a;try{if(this.isComputing)throw new Error("Cycle detected");this.isComputing=!0,a=this.func.call(this.scope),this.hasError=!1}catch(b){this.hasError=!0,console.error(this+"Caught error during computation: ",b),b instanceof Error?a=b:(a=new Error("MobservableComputationError"),a.cause=b)}if(this.isComputing=!1,a!==this._value){var c=this._value;return this._value=a,this.changeEvent.emit(a,c),!0}return!1},c.prototype.toString=function(){return"ComputedObservable["+this.func.toString()+"]"},c}(g);!function(a){a[a.STALE=0]="STALE",a[a.PENDING=1]="PENDING",a[a.READY=2]="READY"}(f||(f={}));var i=function(){function b(a){this.isComputed=a,this.state=f.READY,this.isSleeping=!0,this.hasCycle=!1,this.observing=[],this.prevObserving=null,this.observers=[],this.dependencyChangeCount=0,this.dependencyStaleCount=0,this.isDisposed=!1,this.externalRefenceCount=0}return b.prototype.setRefCount=function(a){var b=this.externalRefenceCount+=a;0===b?this.tryToSleep():b===a&&this.wakeUp()},b.prototype.addObserver=function(a){this.observers[this.observers.length]=a},b.prototype.removeObserver=function(a){var b=this.observers,c=b.indexOf(a);-1!==c&&(b.splice(c,1),0===b.length&&this.tryToSleep())},b.prototype.markStale=function(){this.state===f.READY&&(this.state=f.STALE,this.notifyObservers())},b.prototype.markReady=function(a){this.state!==f.READY&&(this.state=f.READY,this.notifyObservers(a))},b.prototype.notifyObservers=function(a){void 0===a&&(a=!1);for(var b=this.observers.slice(),c=b.length,d=0;c>d;d++)b[d].notifyStateChange(this,a)},b.prototype.tryToSleep=function(){if(this.isComputed&&0===this.observers.length&&0===this.externalRefenceCount&&!this.isSleeping){for(var a=0,b=this.observing.length;b>a;a++)this.observing[a].removeObserver(this);this.observing=[],this.isSleeping=!0}},b.prototype.wakeUp=function(){this.isSleeping&&this.isComputed&&(this.isSleeping=!1,this.state=f.PENDING,this.computeNextState())},b.prototype.notifyStateChange=function(a,b){var c=this;a.state===f.STALE?1===++this.dependencyStaleCount&&this.markStale():(b&&(this.dependencyChangeCount+=1),0===--this.dependencyStaleCount&&(this.state=f.PENDING,l.schedule(function(){c.dependencyChangeCount>0?c.computeNextState():c.markReady(!1),c.dependencyChangeCount=0})))},b.prototype.computeNextState=function(){this.trackDependencies();var a=this.nextState();this.bindDependencies(),this.markReady(a)},b.prototype.nextState=function(){return!1},b.prototype.trackDependencies=function(){this.prevObserving=this.observing,b.trackingStack[b.trackingStack.length]=[]},b.prototype.bindDependencies=function(){this.observing=b.trackingStack.pop(),this.isComputed&&0===this.observing.length&&a.mobservableStatic.debugLevel>1&&!this.isDisposed&&(console.trace(),d("You have created a function that doesn't observe any values, did you forget to make its dependencies observable?"));var e=c(this.observing,this.prevObserving),f=e[0],g=e[1];this.prevObserving=null;for(var h=0,i=g.length;i>h;h++)g[h].removeObserver(this);this.hasCycle=!1;for(var h=0,i=f.length;i>h;h++)this.isComputed&&f[h].findCycle(this)?(this.hasCycle=!0,this.observing.splice(this.observing.indexOf(f[h]),1),f[h].hasCycle=!0):f[h].addObserver(this)},b.prototype.notifyObserved=function(){var a=b.trackingStack,c=a.length;if(c>0){var d=a[c-1],e=d.length;d[e-1]!==this&&d[e-2]!==this&&(d[e]=this)}},b.prototype.findCycle=function(a){var b=this.observing;if(-1!==b.indexOf(a))return!0;for(var c=b.length,d=0;c>d;d++)if(b[d].findCycle(a))return!0;return!1},b.prototype.dispose=function(){if(this.observers.length)throw new Error("Cannot dispose DNode; it is still being observed");for(var a=this.observing.length,b=0;a>b;b++)this.observing[b].removeObserver(this);this.observing=[],this.isDisposed=!0},b.trackingStack=[],b}(),j=function(){function a(a){Object.defineProperties(this,{dependencyState:{enumerable:!1,value:new i(!1)},_values:{enumerable:!1,value:a?a.slice():[]},changeEvent:{enumerable:!1,value:new k}}),a&&a.length&&this.updateLength(0,a.length)}return Object.defineProperty(a.prototype,"length",{get:function(){return this.dependencyState.notifyObserved(),this._values.length},set:function(a){if("number"!=typeof a||0>a)throw new Error("Out of range: "+a);var b=this._values.length;a!==b&&(a>b?this.spliceWithArray(b,0,new Array(a-b)):this.spliceWithArray(a,b-a))},enumerable:!0,configurable:!0}),a.prototype.updateLength=function(b,c){if(0>c)for(var d=b+c;b>d;d++)delete this[d];else if(c>0){b+c>a.OBSERVABLE_ARRAY_BUFFER_SIZE&&a.reserveArrayBuffer(b+c);for(var d=b,e=b+c;e>d;d++)Object.defineProperty(this,""+d,a.ENUMERABLE_PROPS[d])}},a.prototype.spliceWithArray=function(a,b,c){var d=this._values.length;if(!(void 0!==c&&0!==c.length||0!==b&&0!==d))return[];void 0===a?a=0:a>d?a=d:0>a&&(a=Math.max(0,d+a)),b=1===arguments.length?d-a:void 0===b||null===b?0:Math.max(0,Math.min(b,d-a)),void 0===c&&(c=[]);var e=c.length-b,f=(g=this._values).splice.apply(g,[a,b].concat(c));return this.updateLength(d,e),this.notifySplice(a,f,c),f;var g},a.prototype.notifyChildUpdate=function(a,b){this.notifyChanged(),this.changeEvent.emit({object:this,type:"update",index:a,oldValue:b})},a.prototype.notifySplice=function(a,b,c){(0!==b.length||0!==c.length)&&(this.notifyChanged(),this.changeEvent.emit({object:this,type:"splice",index:a,addedCount:c.length,removed:b}))},a.prototype.notifyChanged=function(){this.dependencyState.markStale(),this.dependencyState.markReady(!0)},a.prototype.observe=function(a,b){return void 0===b&&(b=!1),b&&a({object:this,type:"splice",index:0,addedCount:this._values.length,removed:[]}),this.changeEvent.on(a)},a.prototype.clear=function(){return this.splice(0)},a.prototype.replace=function(a){return this.spliceWithArray(0,this._values.length,a)},a.prototype.values=function(){return this.dependencyState.notifyObserved(),this._values.slice()},a.prototype.toJSON=function(){return this.dependencyState.notifyObserved(),this._values.slice()},a.prototype.clone=function(){return this.dependencyState.notifyObserved(),new a(this._values)},a.prototype.find=function(a,b,c){void 0===c&&(c=0),this.dependencyState.notifyObserved();for(var d=this._values,e=d.length,f=c;e>f;f++)if(a.call(b,d[f],f,this))return d[f];return null},a.prototype.splice=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];switch(this.sideEffectWarning("splice"),arguments.length){case 0:return[];case 1:return this.spliceWithArray(a);case 2:return this.spliceWithArray(a,b)}return this.spliceWithArray(a,b,c)},a.prototype.push=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return this.sideEffectWarning("push"),this.spliceWithArray(this._values.length,0,a),this._values.length},a.prototype.pop=function(){return this.sideEffectWarning("pop"),this.splice(Math.max(this._values.length-1,0),1)[0]},a.prototype.shift=function(){return this.sideEffectWarning("shift"),this.splice(0,1)[0]},a.prototype.unshift=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return this.sideEffectWarning("unshift"),this.spliceWithArray(0,0,a),this._values.length},a.prototype.reverse=function(){return this.sideEffectWarning("reverse"),this.replace(this._values.reverse())},a.prototype.sort=function(a){return this.sideEffectWarning("sort"),this.replace(this._values.sort.apply(this._values,arguments))},a.prototype.remove=function(a){this.sideEffectWarning("remove");var b=this._values.indexOf(a);return b>-1?(this.splice(b,1),!0):!1},a.prototype.toString=function(){return this.wrapReadFunction("toString",arguments)},a.prototype.toLocaleString=function(){return this.wrapReadFunction("toLocaleString",arguments)},a.prototype.concat=function(){return this.wrapReadFunction("concat",arguments)},a.prototype.join=function(a){return this.wrapReadFunction("join",arguments)},a.prototype.slice=function(a,b){return this.wrapReadFunction("slice",arguments)},a.prototype.indexOf=function(a,b){return this.wrapReadFunction("indexOf",arguments)},a.prototype.lastIndexOf=function(a,b){return this.wrapReadFunction("lastIndexOf",arguments)},a.prototype.every=function(a,b){return this.wrapReadFunction("every",arguments)},a.prototype.some=function(a,b){return this.wrapReadFunction("some",arguments)},a.prototype.forEach=function(a,b){return this.wrapReadFunction("forEach",arguments)},a.prototype.map=function(a,b){return this.wrapReadFunction("map",arguments)},a.prototype.filter=function(a,b){return this.wrapReadFunction("filter",arguments)},a.prototype.reduce=function(a,b){return this.wrapReadFunction("reduce",arguments)},a.prototype.reduceRight=function(a,b){return this.wrapReadFunction("reduceRight",arguments)},a.prototype.wrapReadFunction=function(b,c){var d=Array.prototype[b];return(a.prototype[b]=function(){return this.dependencyState.notifyObserved(),d.apply(this._values,arguments)}).apply(this,c)},a.prototype.sideEffectWarning=function(a){i.trackingStack.length>0&&d("[Mobservable.Array] The method array."+a+" should not be used inside observable functions since it has side-effects")},a.createArrayBufferItem=function(b){var c={enumerable:!1,configurable:!0,set:function(a){if(b<this._values.length){var c=this._values[b];c!==a&&(this._values[b]=a,this.notifyChildUpdate(b,c))}else{if(b!==this._values.length)throw new Error("ObservableArray: Index out of bounds, "+b+" is larger than "+this.values.length);this.push(a)}},get:function(){return b<this._values.length?(this.dependencyState.notifyObserved(),this._values[b]):void 0}};Object.defineProperty(a.prototype,""+b,c),c.enumerable=!0,a.ENUMERABLE_PROPS[b]=c},a.reserveArrayBuffer=function(b){for(var c=a.OBSERVABLE_ARRAY_BUFFER_SIZE;b>=c;c++)a.createArrayBufferItem(c);a.OBSERVABLE_ARRAY_BUFFER_SIZE=b},a.OBSERVABLE_ARRAY_BUFFER_SIZE=0,a.ENUMERABLE_PROPS=[],a}();j.reserveArrayBuffer(1e3);var k=function(){function a(){this.listeners=[]}return a.prototype.emit=function(){var a=this.listeners.slice(),b=a.length;switch(arguments.length){case 0:for(var c=0;b>c;c++)a[c]();break;case 1:for(var d=arguments[0],c=0;b>c;c++)a[c](d);break;default:for(var c=0;b>c;c++)a[c].apply(null,arguments)}},a.prototype.on=function(a){var b=this;return this.listeners.push(a),e(function(){var c=b.listeners.indexOf(a);-1!==c&&b.listeners.splice(c,1)})},a.prototype.once=function(a){var b=this.on(function(){b(),a.apply(this,arguments)});return b},a}();a.mobservableStatic.SimpleEventEmitter=k;var l=function(){function a(){}return a.schedule=function(b){a.inBatch<1?b():a.tasks[a.tasks.length]=b},a.runPostBatchActions=function(){for(var b=0;a.tasks.length;)try{for(;b<a.tasks.length;b++)a.tasks[b]();a.tasks=[]}catch(c){console.error("Failed to run scheduled action, the action has been dropped from the queue: "+c,c),a.tasks.splice(0,b+1)}},a.batch=function(b){a.inBatch+=1;try{return b()}finally{0===--a.inBatch&&a.runPostBatchActions()}},a.inBatch=0,a.tasks=[],a}();a.mobservableStatic.quickDiff=c,a.mobservableStatic.stackDepth=function(){return i.trackingStack.length}}(mobservable||(mobservable={})),function(a,b){"function"==typeof define&&define.amd?define("mobservable",[],function(){return b()}):"object"==typeof exports?module.exports=b():a.mobservable=b()}(this,function(){return mobservable.mobservableStatic});